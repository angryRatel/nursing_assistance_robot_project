# 🤖 ARM 기반 간호 어시스턴트 로봇

> 병원 내 간호사의 반복 업무를 줄이기 위해 약품 전달 및 환자 생체징후 확인이 가능한 ROS2 기반의 간호 어시스턴트 로봇을 개발한 프로젝트입니다.

---

## 🎥 시연 영상  
[![Demo Video](https://img.youtube.com/vi/MnMJ5cEe0sA/0.jpg)](https://youtu.be/MnMJ5cEe0sA)

## 📑 발표 자료  
https://docs.google.com/presentation/d/1NZCnV38TH0ElrKdvknqc87FGtfnRYHoj/edit?usp=sharing

---

## 📌 프로젝트 개요

본 프로젝트는 **Turtlebot4**와 **ROS 2 Humble**을 기반으로 하여,  
병원 내 반복적인 간호 업무 중 **약품 전달**과 **환자 바이탈 체크**를 로봇이 대신 수행하도록 설계한 팀 프로젝트입니다.

---

## 🛠️ 사용 환경
![사용환경](images/사용환경.png)

---

## 🗺 병동 MAP
![병동](images/병동.png)

---

## 👥 팀 구성

| 이름 | 담당 역할 |
|------|------------|
| 백홍하 (팀장) | /robot4/Vision, Main Controller GUI |
| 이하빈 | /robot4/Vision, ROS 통신 |
| 장연호 | /robot4/Navigation, EMQX Cloud 통신 |
| 정찬원 | /robot4/Navigation, 영상 편집 |
| 이경민 | /robot1/Vision |
| 최정호 | /robot1/Vision |
| 문준웅 | /robot1/Navigation, Main Controller GUI |
| 정민섭 | /robot1/Navigation, 바이탈 체크 기능 개발 |

---

## 🗓️ 작업 일정

| 기간 | 내용 |
|------|------|
| 06.23 ~ 06.26 | 프로젝트 기획, 기술 검증 |
| 06.27 ~ 06.28 | robot1 / robot4 노드 개발 |
| 06.29 ~ 06.30 | ROS 통신 통합, GUI 개발 |
| 07.01 ~ 07.03 | MQTT 연동, 바이탈 체크 개발 |
| 07.03 ~ 07.04 | 발표 자료 및 문서 작성 |

---

## 🧩 System 아키텍처  
![System Architecture](images/2.png)

## 🧠 Node 아키텍처  
![Node Architecture](images/3.png)

## 🔁 System 플로우  
![System Flow](images/4.png)

---

## ✅ 주요 기능

- **약품 탐지 및 위치 추정**: YOLOv8s 모델을 사용해 약품(타이레놀, 붕대 등)을 정확하게 탐지하고 Depth + TF2 변환을 통해 map 좌표를 추정  
- **자율 주행 네비게이션**: 병동 내 복잡한 환경에서도 안정적으로 자율 주행 가능. SLAM 기반 Nav2 적용  
- **바이탈 체크 기능**: rPPG 기반 비접촉 생체신호 측정 기능 탑재 (심박수, 산소포화도, 혈압 추정)  
- **사람 감지 기반 정지/재개**: 이동 중 사람을 감지하면 정지하고, 사람이 사라지면 자동 재개  
- **클라우드 통신**: MQTT Cloud를 통해 병동 로봇과 조제실 로봇 간 위치 동기화 및 플래그 전달  
- **GUI 대시보드**: 물품 요청, 환자 배정, 위치 확인 및 상태 확인이 가능한 GUI 시스템 구현

---

## 🧠 문제 해결 및 개선

- **YOLO + Depth 오차 보정**: 기존 해상도(240p)에서 depth 오차 발생 → 해상도 480p로 상향하여 위치 추정 정확도 개선  
- **통신 병합 문제**: TurtleBot2대가 단일 공유기 사용 시 트래픽 병합 문제 발생 → MQTT Cloud 기반 통신으로 전환하여 평균 35% 네트워크 사용량 감소  
- **고화질 영상 출력 오류**:  
  - `i_low_bandwidth=True`로 설정 시, 압축된 이미지(compressed image)만 전송되어 영상이 흐릿하고, depth 추정이나 객체 인식 정확도 저하 발생  
  - **해결**: `i_low_bandwidth=False`로 설정하여 고화질 원본 이미지 전송 가능 → 정확한 YOLO 탐지 및 위치 추정, rPPG 성능 향상
- **실시간성 부족 문제**: OAK-D 카메라 사용 시 프레임 처리 지연 → FPS를 2로 조정하고 이미지 큐 크기 조절로 실시간성 확보  
- **바이탈 체크 신뢰도 개선**: 얼굴 추적은 KCF 트래커, 빛 노이즈는 RGB 평탄화, rPPG 필터는 CHROM method 적용



---

## 🏆 프로젝트 성과

- 두 대의 TurtleBot4가 협력하여 자율 주행 및 약품 전달, 생체징후 확인 미션 수행  
- MQTT Cloud 기반 통신 구조 완성 → 실시간 위치 공유 및 플래그 전달  
- YOLOv8 기반 약품 탐지 정확도 95% 이상 달성  
- 비접촉 생체징후 측정 (rPPG) 기능 구현 완료  
- 평균 자율 주행 성공률 95%, 네트워크 리소스 사용량 35% 감소  


---

## 💡 향후 개선 아이디어

- **PID 제어 추가**: TurtleBot의 정밀 이동 성능 향상을 위한 PID 제어 도입 예정  
- **카메라 성능 개선**: 실시간성 향상을 위한 이미지 토픽 경량화 및 고성능 센서 적용  
- **GUI 고도화**: 관리자 기능 추가 및 모바일 대응 UI 설계  
- **상황 인식 확장**: 긴급 상황 감지 및 음성 안내 기능 추가  
- **스마트 병동 확장**: 실제 병원 환경 적용을 고려한 스마트 인프라 구성 (RFID, 자동문 연동 등)

---

## 📚 개인적 배운 점

- ROS2 서비스/토픽 통신 구조 이해 및 적용  
- 실제 로봇 하드웨어와 소프트웨어 통합 개발 경험  
- 협업, 일정 관리, Git 사용 능력 향상
- OAK-D 카메라 파라미터를 직접 조정하며 영상 처리 성능, 대역폭 최적화, 실시간성 간의 트레이드오프를 경험했고,  
  `i_low_bandwidth`, `i_fps`, `i_max_q_size` 등의 설정이 실제 시스템 성능에 어떤 영향을 주는지 깊이 있게 이해할 수 있었음 
---

> 본 프로젝트는 실시간 로봇 통신, IoT 연동, GUI 모니터링 등 다양한 기술을 통합하여 병원 환경에 특화된 간호 로봇 시스템을 구축한 사례입니다.

추가
> compressed image를 받아왔을때와 아닐때를 비교하는 추가자료가 필요
> 쓰레드기능추가해서 이미지출력부분 병렬로 하나 더해서 영상 끊김해결에 대한 자료가 필요

